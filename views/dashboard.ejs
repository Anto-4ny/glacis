<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Glacis || Dashboard</title>
    <meta name="description" content="Glacis offers an online earning platform where users make money by inviting others, helping verify new users, selling ebooks, advertising, and more.">
    <meta property="og:title" content="Glacis">
    <meta property="og:description" content="Join Glacis to earn money through various online opportunities including referrals, verifications, and advertising.">
    <meta property="og:image" content="/images/glacis-logo.jpg">
    <meta property="og:url" content="https://glacis.antocapteknologies.com">

    <!-- Use only one Font Awesome import -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Favicon -->
    <link rel="icon" href="/images/glacis-logo.jpg" type="image/x-icon">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN (Load this in the <head> or before your script) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<!-- Header -->
<header class="flex flex-col bg-gradient-to-r from-gray-900 via-gray-800 to-gray-100 shadow-lg fixed w-full top-0 z-50 border-b border-gray-300 h-28 px-6">
 
<!-- Top Section with Icons (Hidden on Small Screens) -->
<div class="hidden lg:flex items-center space-x-4 bg-white shadow-md rounded-full border border-gray-300 px-4 py-2 w-fit absolute right-6 top-0 mb-4">
    <button id="theme-toggle" class="text-yellow-500 text-xl hover:text-yellow-600 transition">
        <i class="fas fa-moon"></i>
    </button>
    <button id="language-toggle" class="text-blue-500 text-xl hover:text-blue-600 transition">
        <i class="fas fa-language"></i>
    </button>
    <button id="notification-bar" class="relative text-green-500 text-xl hover:text-green-600 transition">
        <i class="fas fa-bell"></i>
        <span class="absolute -top-1 -right-1 bg-red-600 text-white text-xs w-4 h-4 flex items-center justify-center rounded-full">3</span>
    </button>
</div>


    <!-- Main Header Section -->
    <div class="flex items-center justify-between py-1">
        <a href="/" class="flex items-center space-x-3">
            <img id="logo" src="/images/glacis-logo.jpg" alt="Logo" class="h-16 w-16 rounded-full shadow-md">  <!-- Increased size -->
            <div class="flex items-center justify-center font-extrabold">
                <span class="text-6xl text-blue-600">G</span>
                <span class="text-4xl text-purple-500">l</span>
                <span class="text-4xl text-pink-500">a</span>
                <span class="text-4xl text-blue-800">c</span>
                <span class="text-4xl text-yellow-500">i</span>
                <span class="text-4xl text-green-600">s</span>
            </div>                        
        </a>

       <!-- Desktop Navigation -->
<nav class="hidden lg:flex space-x-8 bg-white px-10 py-3 shadow-md rounded-full border border-gray-300 mt-10">
    <a href="dashboard" class="text-gray-900 font-semibold hover:text-blue-500 transition duration-300">Dashboard</a>
    <a href="earnings" class="text-gray-900 font-semibold hover:text-blue-500 transition duration-300">Earnings</a>
    <a href="validator" class="text-gray-900 font-semibold hover:text-blue-500 transition duration-300">Validator</a>
    <a href="referral" class="text-gray-900 font-semibold hover:text-blue-500 transition duration-300">Referrals</a>
    <a href="withdraw" class="text-gray-900 font-semibold hover:text-blue-500 transition duration-300">Withdraw</a>
    <a href="videos" class="text-gray-900 font-semibold hover:text-blue-500 transition duration-300">Videos</a>
    <a href="help" class="text-gray-900 font-semibold hover:text-blue-500 transition duration-300">Help</a>
    <a href="profile" class="text-gray-900 font-semibold hover:text-blue-500 transition duration-300">Profile</a>
    <button id="logout-button" class="text-red-500 font-semibold hover:text-red-700 transition duration-300">Log Out</button>
</nav>


        <!-- Mobile Navigation Icon -->
        <button id="hamburger-icon" class="text-gray-900 text-2xl lg:hidden">
            <i class="fas fa-bars"></i>
        </button>
    </div>
</header>

<!-- Overlay -->
<div id="overlay" class="fixed inset-0 bg-black bg-opacity-30 hidden lg:hidden"></div>

<!-- Mobile Navigation -->
<nav id="mobile-nav" class="fixed left-0 top-0 h-full w-3/4 bg-white text-gray-900 shadow-2xl transform -translate-x-full transition-transform lg:hidden z-50 rounded-r-2xl">
    <div class="p-6 border-b flex justify-between items-center">
        <h3 class="text-xl font-semibold">Menu</h3>
        <button id="close-nav" class="text-gray-700 text-2xl"><i class="fas fa-times"></i></button>
    </div>
    <div class="p-6 flex flex-col space-y-4 text-lg">
        <a href="dashboard" class="flex items-center space-x-3 hover:text-blue-500">
            <i class="fas fa-tachometer-alt"></i><span>Dashboard</span>
        </a>
        <a href="earnings" class="flex items-center space-x-3 hover:text-blue-500">
            <i class="fas fa-dollar-sign"></i><span>Earnings</span>
        </a>
        <a href="validator" class="flex items-center space-x-3 hover:text-blue-500">
            <i class="fas fa-user-check"></i><span>Validator</span>
        </a>
        <a href="referral" class="flex items-center space-x-3 hover:text-blue-500">
            <i class="fas fa-user-friends"></i><span>Referrals</span>
        </a>
        <a href="withdraw" class="flex items-center space-x-3 hover:text-blue-500">
            <i class="fas fa-wallet"></i><span>Withdraw</span>
        </a>
        <a href="videos" class="flex items-center space-x-3 hover:text-blue-500">
            <i class="fas fa-info-circle"></i><span>Videos</span>
        </a>
        <a href="help" class="flex items-center space-x-3 hover:text-blue-500">
            <i class="fas fa-question-circle"></i><span>Help</span>
        </a>
        <a href="profile" class="flex items-center space-x-3 hover:text-blue-500">
            <i class="fas fa-user"></i><span>Profile</span>
        </a>
        <button id="logout-button" class="flex items-center space-x-3 text-red-500 hover:text-red-700">
            <i class="fas fa-sign-out-alt"></i><span>Log Out</span>
        </button>
    </div>
    
    <!-- Mobile Icons Section (Now inside the menu for small screens) -->
    <div class="p-6 border-t flex justify-around text-gray-700 text-xl bg-white shadow-md rounded-b-2xl">
        <button id="theme-toggle" class="text-yellow-500 hover:text-yellow-600 transition">
            <i class="fas fa-moon"></i>
        </button>
        <button id="language-toggle" class="text-blue-500 hover:text-blue-600 transition">
            <i class="fas fa-language"></i>
        </button>
        <button id="notification-bar" class="relative text-green-500 hover:text-green-600 transition">
            <i class="fas fa-bell"></i>
            <span class="absolute -top-1 -right-1 bg-red-600 text-white text-xs w-4 h-4 flex items-center justify-center rounded-full">3</span>
        </button>
    </div>
</nav>

<body class="bg-gray-100 font-sans mt-20"></body>
<style>
#payment-popup {
    z-index: 1000 !important;
    display: flex !important;
}

 .hidden {
    display: none !important;
    opacity: 0 !important;
    pointer-events: none !important;
    visibility: hidden !important;
}
</style>
<div id="payment-popup" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden transition-opacity duration-300 ease-in-out">
    <div class="relative bg-white p-6 rounded-2xl shadow-2xl max-w-lg w-full sm:w-4/5 md:w-2/3 lg:w-1/3 h-[85vh] overflow-y-auto border border-gray-200">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-4">User Registration & Activation</h2>
        <p class="text-gray-500 text-sm text-center mb-6">
            To fully activate your account, choose one of the following options:
        </p>

        <div class="space-y-4">
            <div class="border p-4 rounded-lg bg-gray-50 hover:bg-gray-100 transition membership-option" data-type="common">
                <h3 class="text-lg font-semibold text-gray-800">Common Member</h3>
                <p class="text-gray-500 text-sm">Register with a one-time fee of <strong class="text-green-600">$6</strong> to start earning.</p>
            </div>
        </div>            

        <h3 class="text-lg font-semibold mt-6">Payment Methods</h3>
        <p class="text-gray-500 text-sm">Payments are done manually via <strong>Binance</strong>.</p>

        <h3 class="text-lg font-semibold mt-6">Wallet Addresses</h3>
        <div class="space-y-2">
            <div class="flex justify-between items-center bg-gray-100 p-2 rounded-lg">
                <span class="text-sm text-gray-700">Binance: <strong id="binance-wallet">821693759</strong></span>
                <button onclick="copyToClipboard('binance-wallet')" class="bg-blue-500 text-white px-2 py-1 rounded">Copy</button>
            </div>
        </div>

                      <!-- Success Message -->
<div id="statusMessage" class="hidden text-green-700 bg-green-100 border-l-4 border-green-500 p-3 rounded-md my-2">
</div>

<!-- Error Message -->
<div id="statusMessage" class="hidden text-red-700 bg-red-100 border-l-4 border-red-500 p-3 rounded-md my-2">
</div>

        <h3 class="text-lg font-semibold mt-6">Payment Submission</h3>
        <p class="text-gray-600 text-sm mb-4">Submit your payment details for verification:</p>

<form id="payment-form" class="space-y-4">
    <div>
        <label class="block text-sm font-medium text-gray-700">Transaction Hash (TXID)</label>
        <input type="text" id="txid" placeholder="Enter TXID" class="w-full p-3 border rounded-lg focus:ring focus:ring-blue-300 transition">
    </div>

    <div>
        <label class="block text-sm font-medium text-gray-700">Wallet Address Used</label>
        <input type="text" id="wallet-address" placeholder="Enter Wallet Address" class="w-full p-3 border rounded-lg focus:ring focus:ring-blue-300 transition">
    </div>

    <div>
        <label class="block text-sm font-medium text-gray-700">Date & Time of Payment</label>
        <input type="datetime-local" id="payment-date" class="w-full p-3 border rounded-lg focus:ring focus:ring-blue-300 transition">
    </div>

    <!-- FIX: Corrected button type to "submit" -->
    <button type="submit" id="pay-btn" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition text-lg font-semibold">
        Submit for Verification
    </button>
</form>
</div>
    </div>

<!-- Spacer for Other Items -->
<div class="h-8 md:h-14 lg:h-8"></div>

      <!-- Banner Area -->
<section class="relative w-full h-[400px] md:h-[500px] lg:h-[600px] flex items-center justify-center text-center overflow-hidden bg-gradient-to-r from-white to-gray-100 shadow-lg rounded-2xl">

    <!-- Moving Shapes -->
    <div class="absolute inset-0 overflow-hidden">
        <div class="absolute w-14 h-14 md:w-20 md:h-20 bg-blue-400 rounded-full opacity-50 animate-float" style="top: 5%; left: 10%;"></div>
        <div class="absolute w-24 h-24 md:w-28 md:h-28 bg-yellow-400 rounded-full opacity-50 animate-float-reverse" style="top: 10%; right: 15%;"></div>
        <div class="absolute w-32 h-32 md:w-40 md:h-40 bg-red-400 rounded-full opacity-50 animate-float" style="bottom: 8%; left: 20%;"></div>
        <div class="absolute w-20 h-20 md:w-28 md:h-28 bg-purple-500 rounded-md opacity-50 transform rotate-45 animate-float-reverse" style="bottom: 5%; right: 10%;"></div>
        <div class="absolute w-10 h-10 md:w-16 md:h-16 bg-green-400 rounded-full opacity-50 animate-float" style="top: 50%; left: 50%;"></div>
        <div class="absolute w-16 h-16 md:w-24 md:h-24 bg-orange-400 rounded-md opacity-50 transform rotate-12 animate-float" style="top: 20%; left: 40%;"></div>
        <div class="absolute w-12 h-12 md:w-18 md:h-18 bg-pink-400 rounded-full opacity-50 animate-float-reverse" style="bottom: 15%; right: 30%;"></div>
    </div>

    <!-- Banner Content -->
    <div class="relative z-10 px-6 lg:px-12">
        <h1 class="text-gray-900 text-3xl md:text-5xl font-extrabold tracking-wide uppercase bg-clip-text text-transparent bg-gradient-to-r from-blue-500 to-purple-600">
            Welcome to Your Dashboard
        </h1>
        <p class="text-gray-700 text-lg md:text-xl mt-4 max-w-2xl mx-auto">
            Track earnings, referrals, and validator progress effortlessly. Take control of your journey now!
        </p>

        <!-- Get Started Button -->
        <div class="mt-6">
            <a href="/validator" class="px-6 py-3 text-lg font-semibold text-white bg-gradient-to-r from-blue-500 to-purple-600 rounded-full shadow-md hover:scale-105 transition-transform duration-300">
                Get Started
            </a>
        </div>
    </div>
</section>

<!-- Floating Animations -->
<style>
    @keyframes float {
        0% { transform: translateY(0px) translateX(0px); }
        50% { transform: translateY(-30px) translateX(15px); }
        100% { transform: translateY(0px) translateX(0px); }
    }

    @keyframes float-reverse {
        0% { transform: translateY(0px) translateX(0px); }
        50% { transform: translateY(30px) translateX(-15px); }
        100% { transform: translateY(0px) translateX(0px); }
    }

    .animate-float {
        animation: float 8s infinite ease-in-out alternate;
    }

    .animate-float-reverse {
        animation: float-reverse 8s infinite ease-in-out alternate;
    }
</style>

<section id="dashboard" class="p-6 bg-gray-100 min-h-screen">

        <section id="dashboard-info" class="p-6 bg-gray-100 min-h-screen">
            <!-- Notification Bar -->
         <div id="notification-bar" class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6 relative shadow-lg rounded-md">
            <p class="font-semibold">Welcome back</p>
            <span class="absolute top-2 right-4 cursor-pointer text-xl font-bold" id="close-notification">&times;</span>
        </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- User Registration & Activation -->
                <div class="bg-white shadow-lg rounded-xl p-6 border-l-4 border-blue-500">
                    <h3 class="text-xl font-bold text-gray-800 mb-2">User Registration & Activation</h3>
                    <p class="text-gray-600">Register as a common member with <strong>$6</strong> or as a validator with <strong>$40</strong>.</p>
                </div>
                
                <!-- Validator Responsibilities -->
                <div class="bg-white shadow-lg rounded-xl p-6 border-l-4 border-yellow-500">
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Validator Responsibilities</h3>
                    <p class="text-gray-600">Validators verify user payments and earn <strong>$2.5 per validation</strong>. At least two validators must approve a payment.</p>
                </div>
                
                <!-- Referral System -->
                <div class="bg-white shadow-lg rounded-xl p-6 border-l-4 border-green-500">
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Referral Earnings</h3>
                    <ul class="list-disc pl-5 text-gray-600">
                        <li>Direct referrals earn <strong>$6</strong> per activated account.</li>
                        <li>Level 2 referrals earn <strong>$3</strong> per activation.</li>
                        <li>If a referral registers as a validator, earn <strong>$10</strong> (direct) or <strong>$5</strong> (level 2).</li>
                    </ul>
                </div>
                
                <!-- Payment System -->
                <div class="bg-white shadow-lg rounded-xl p-6 border-l-4 border-purple-500">
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Payment System</h3>
                    <p class="text-gray-600">Payments are done manually through <strong>Binance & Metamask </strong>.</p>
                </div>
                
                <!-- Transaction Proof Submission -->
                <div class="bg-white shadow-lg rounded-xl p-6 border-l-4 border-red-500">
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Transaction Proof Submission</h3>
                    <ul class="list-disc pl-5 text-gray-600">
                        <li>Transaction Hash (TXID)</li>
                        <li>Screenshot of completed transaction</li>
                        <li>Payment method used</li>
                        <li>Sender and receiver wallet addresses</li>
                    </ul>
                </div>
                
                <!-- Dashboard Features -->
                <div class="bg-white shadow-lg rounded-xl p-6 border-l-4 border-indigo-500">
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Dashboard Features</h3>
                    <ul class="list-disc pl-5 text-gray-600">
                        <li>Account activation & verification status</li>
                        <li>Unique referral link</li>
                        <li>Validator panel for pending verifications</li>
                        <li>Wallet withdrawals (min: $1, 24hr approval)</li>
                    </ul>
                </div>
            </div>
        </section>
        
     <div>
            <div class="bg-white shadow-2xl rounded-2xl p-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Earnings Histogram</h3>
                <canvas id="histogramChart"></canvas>
            </div>
        </div>
    
      <!-- Referral Section -->
<div class="bg-white shadow-xl rounded-2xl p-8 mt-6 max-w-3xl mx-auto border border-gray-200">
    <h3 class="text-xl font-bold text-gray-900 mb-4">Your Referral Link</h3>
    
    <div class="flex items-center space-x-4 bg-gray-100 p-3 rounded-lg shadow-inner">
        <p id="referral-link" class="flex-grow text-gray-800 bg-white px-4 py-2 rounded-md border border-gray-300 overflow-hidden text-ellipsis whitespace-nowrap">
            Your Referral Link Here
        </p>
        <button id="copy-link-button" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold rounded-lg shadow-md hover:scale-105 transition-transform duration-300">
            Copy
        </button>
        <a id="whatsapp-share-button" target="_blank" class="px-4 py-2 bg-green-500 text-white rounded-lg shadow-md hover:bg-green-600 transition duration-300">
            <i class="fab fa-whatsapp text-lg"></i>
        </a>
    </div>
    
    <!-- Referred Friends Section -->
    <h3 class="text-xl font-bold text-gray-900 mt-6">Your Referred Friends</h3>
    
    <div class="overflow-x-auto mt-4 bg-gray-50 p-4 rounded-lg shadow-lg border border-gray-200">
        <table class="w-full border-collapse text-sm text-left">
            <thead>
                <tr class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg">
                    <th class="p-3 text-left">Email</th>
                    <th class="p-3 text-left">Status</th>
                </tr>
            </thead>
            <tbody id="referred-users-list" class="text-gray-800">
                <!-- Referred users will be dynamically inserted here -->
            </tbody>
        </table>
    </div>
</div>
    </section>

    <section>
        <!-- Social Media Links -->
    <div class="bg-white shadow-md rounded-lg p-6 mt-6 max-w-3xl mx-auto text-center">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Follow Us on Social Media</h3>
        <div class="flex justify-center space-x-6">
            <!--<a href="https://t.me/yourchannel" target="_blank" class="text-blue-500 text-2xl hover:text-blue-700">
                <i class="fab fa-telegram-plane"></i>-->
            </a>
            <a href="https://x.com/GlaciasO25?t=O5kjLwkcjx_dVI_KsOSmwQ&s=09" target="_blank" class="text-blue-400 text-2xl hover:text-blue-600">
                <i class="fab fa-twitter"></i>
            </a>
            <a href="https://www.facebook.com/profile.php?id=100076146367834" target="_blank" class="text-blue-600 text-2xl hover:text-blue-800">
                <i class="fab fa-facebook"></i>
            </a>
            <a href="https://www.instagram.com/tonyasembo?igsh=YzljYTk1ODg3Zg==" target="_blank" class="text-pink-500 text-2xl hover:text-pink-700">
                <i class="fab fa-instagram"></i>
            </a>
            <a href="https://www.tiktok.com/@antonytheeson?_t=ZM-8uB5WCMpRBd&_r=1" target="_blank" class="text-black text-2xl hover:text-gray-700 mx-2">
                <i class="fab fa-tiktok"></i>
            </a>
            
        </div>
    </div>
    </section>
    
    <footer class="bg-gray-900 text-white text-center py-4">
        <p class="copyright-text text-sm">
            &copy; 2025 <span class="font-bold">Glacis</span>. All rights reserved.
        </p>
        <p class="text-xs mt-1">
            Designed by 
            <a href="https://antocapteknologies.com" class="text-blue-400 hover:text-blue-300 font-semibold" target="_blank">
                Antocap Teknologies
            </a>
        </p>
    </footer>    
      
    <script type ="module" src="https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js"></script>
    <script type ="module" src="https://www.gstatic.com/firebasejs/11.4.0/firebase-analytics.js"></script>
    <script type ="module" src="https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js"></script>
    <script type ="module" src="https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js"></script>
    <script type ="module" src="https://www.gstatic.com/firebasejs/11.4.0/firebase-storage.js"></script>
  
       <!-- Your custom script -->
       <script type="module" src="script.js"></script>
<script type="module" src="referral.js"></script>
<script type="module">
import { auth, db, doc, getDoc, updateDoc, query, collection, getDocs, addDoc, onAuthStateChanged, onSnapshot, where, serverTimestamp } from "./script.js";

document.addEventListener("DOMContentLoaded", async () => {
    const popup = document.getElementById("payment-popup");
    const errorMessageDiv = document.getElementById("error-message");
    const successMessageDiv = document.getElementById("success-message");
    const payBtn = document.getElementById("pay-btn");
    const txidInput = document.getElementById("txid");
    const walletAddressInput = document.getElementById("wallet-address");
    const paymentDateInput = document.getElementById("payment-date");
    const form = document.getElementById("payment-form");

    const statusMessage = document.createElement("p");
    statusMessage.id = "payment-status";
    statusMessage.classList.add("text-sm", "text-gray-700", "mt-2");
    if (form) form.appendChild(statusMessage);

// Function to show messages in the UI
function showMessage(message, type) {
    const messageDiv = document.getElementById("statusMessage");
    
    if (!messageDiv) {
        console.warn("⚠️ Message div not found in DOM.");
        return;
    }

    messageDiv.textContent = message;
    messageDiv.classList.remove("hidden", "bg-green-100", "text-green-700", "bg-red-100", "text-red-700");

    if (type === "success") {
        messageDiv.classList.add("bg-green-100", "text-green-700");
    } else {
        messageDiv.classList.add("bg-red-100", "text-red-700");
    }

    // Hide the message after 4 seconds
    setTimeout(() => messageDiv.classList.add("hidden"), 4000);
}

// Handle form submission
if (!form) {
    console.warn("⚠️ Payment form not found on this page.");
} else {
    if (!txidInput || !walletAddressInput || !paymentDateInput || !payBtn) {
        console.error("❌ Form elements missing! Check your HTML.");
    } else {
        form.addEventListener("submit", async (event) => {
            event.preventDefault();

            const txid = txidInput.value.trim();
            const walletAddress = walletAddressInput.value.trim();
            const paymentDate = paymentDateInput.value.trim();
            const user = auth.currentUser;

            if (!txid || !walletAddress || !paymentDate) {
                showMessage("⚠️ All fields are required.", "error");
                return;
            }

            if (!user?.email) {
                showMessage("❌ User not authenticated. Please log in.", "error");
                return;
            }

            try {
                // Check if the user has already submitted a pending payment
                const existingPaymentQuery = query(
                    collection(db, "payments"),
                    where("email", "==", user.email),
                    where("paymentApproved", "==", "pending")
                );
                const existingPayments = await getDocs(existingPaymentQuery);

                if (!existingPayments.empty) {
                    showMessage("⚠️ You already submitted a payment. Waiting for validation.", "error");
                    return;
                }

                // Fetch eligible validators (users with isValidator = true)
                const validatorQuery = query(
                    collection(db, "users"),
                    where("isValidator", "==", true)
                );
                const validatorSnap = await getDocs(validatorQuery);
                let validatorList = [];

                validatorSnap.forEach((doc) => {
                    validatorList.push(doc.id);
                });

                if (validatorList.length === 0) {
                    showMessage("⚠️ No validators available. Please wait.", "error");
                    return;
                }

                // Select one random validator
                let assignedValidator = validatorList[Math.floor(Math.random() * validatorList.length)];

                // Add the payment entry to Firestore
                const paymentRef = await addDoc(collection(db, "payments"), {
                    email: user.email,
                    txid,
                    walletAddress,
                    paymentDate,
                    paymentApproved: "pending", // ✅ Corrected field
                    assignedValidators: [assignedValidator],
                    approvals: [],
                    type: "membership",
                    timestamp: serverTimestamp(),
                });

                // Lock form inputs after submission
                txidInput.disabled = true;
                walletAddressInput.disabled = true;
                paymentDateInput.disabled = true;
                payBtn.disabled = true;
                payBtn.textContent = "Submitted";

                showMessage("✅ Payment submitted successfully! Awaiting approval.", "success");

                // Listen for real-time updates on payment approval
                const paymentDocRef = doc(db, "payments", paymentRef.id);
                onSnapshot(paymentDocRef, async (docSnap) => {
                    if (docSnap.exists() && docSnap.data().paymentApproved === "approved") {
                        // Update user document to set membershipApproved = true
                        await updateDoc(doc(db, "users", user.uid), {
                            membershipApproved: true
                        });

                        showMessage("✅ Payment approved! Welcome to the membership.", "success");

                    }
                });

            } catch (error) {
                showMessage(`❌ Error: ${error.message}`, "error");
                console.error("Payment Submission Error:", error);
            }
        });
    }
}

});



document.getElementById("close-notification").addEventListener("click", function () {
    document.getElementById("notification-bar").style.display = "none";
});

document.addEventListener("DOMContentLoaded", async function () {
    const ctx4 = document.getElementById("histogramChart").getContext("2d");


    try {
        const usersRef = collection(db, "users");
        const usersSnapshot = await getDocs(usersRef);
        const earningsData = [];
        const labels = [];

        usersSnapshot.forEach((doc) => {
            const userData = doc.data();
            if (userData.totalEarnings) {
                earningsData.push(userData.totalEarnings);
                labels.push(userData.firstName || "User"); // Default to "User" if no name
            }
        });

        if (earningsData.length === 0) {
            console.warn("No earnings data found in Firestore.");
        }

        new Chart(ctx4, {
            type: "bar",
            data: {
                labels,
                datasets: [{
                    label: "Earnings Distribution",
                    data: earningsData,
                    backgroundColor: "#673AB7"
                }]
            },
            options: { responsive: true }
        });

    } catch (error) {
        console.error("Error fetching earnings data:", error);
    }
});

    
  document.addEventListener("contextmenu", function (event) {
    event.preventDefault(); // Disable right-click
  });

  document.addEventListener("keydown", function (event) {
    if (event.ctrlKey && (event.key === "u" || event.key === "U")) {
      event.preventDefault(); // Disable "View Source" (Ctrl + U)
    }
    if (event.ctrlKey && event.shiftKey && event.key === "I") {
      event.preventDefault(); // Disable DevTools (Ctrl + Shift + I)
    }
    if (event.ctrlKey && event.shiftKey && event.key === "J") {
      event.preventDefault(); // Disable DevTools (Ctrl + Shift + J)
    }
    if (event.ctrlKey && event.key === "S") {
      event.preventDefault(); // Disable Save (Ctrl + S)
    }
    if (event.ctrlKey && event.key === "P") {
      event.preventDefault(); // Disable Print (Ctrl + P)
    }
  });


</script>
</body>
</html>
